---
id: index
title: "ZIO Google Cloud clients"
sidebar_label: "ZIO Google Cloud clients"
---

![Maven Central Version](https://img.shields.io/maven-central/v/com.anymindgroup/zio-gcp-auth_3)
![Maven Snapshot Version](https://img.shields.io/maven-metadata/v?metadataUrl=https:%2F%2Fcentral.sonatype.com%2Frepository%2Fmaven-snapshots%2Fcom%2Fanymindgroup%2Fzio-gcp-auth_3%2Fmaven-metadata.xml&label=maven-snapshots)

Collection of Google Cloud clients generated by [Google REST API code generator](https://github.com/rolang/google-rest-api-codegen) including authentication.
based on [ZIO](https://zio.dev), [Sttp (v4)](https://sttp.softwaremill.com/en/latest/) and [Jsoniter](https://github.com/plokhotnyuk/jsoniter-scala).  

Released for Scala 3 with cross-platform support.  
Supported platforms: 
 - ✅ JVM 
   - tested java versions: 21
 - ✅ Native with LLVM (via [scala-native](https://scala-native.org/))
   - backed by [libcurl](https://curl.se/libcurl)
   - http backend uses sync curl implementation, [async backend](https://github.com/softwaremill/sttp/issues/1424) might be added at some point...
 - ❌ JavaScript (via [scala-js](https://www.scala-js.org), could be potentially added)

## Included modules / clients

- `zio-gcp-auth` Module providing authentication methods and http backends.  
More details about authentication under [Authentication](#authentication) section.
- `zio-gcp-storage` Google Cloud Storage package based on `zio-gcp-storage-v1` and `zio-gcp-iamcredentials-v1` client code 
with support for creating [Signed URLs](https://cloud.google.com/storage/docs/access-control/signed-urls).
- `zio-gcp-sheets` Google Spreadsheets package based on `zio-gcp-sheets-v4` with extra methods / json codecs for convenience
 (see usage [example](../examples/shared/src/main/scala/sheets_example.scala)).

### generated clients
- `zio-gcp-aiplatform-v1` Client code for [Google Cloud Vertex AI API](https://cloud.google.com/vertex-ai/docs/reference/rest).
- `zio-gcp-pubsub-v1` Client code for [Google Cloud Pub/Sub API](https://cloud.google.com/pubsub/docs/reference/rest/).
- `zio-gcp-storage-v1`Client code for [Google Cloud Storage API](https://cloud.google.com/storage/docs/json_api).
- `zio-gcp-iamcredentials-v1`Client code for [Google Cloud IAM Credentials API](https://cloud.google.com/iam/docs/reference/credentials/rest/).
- `zio-gcp-sheets-v4` Client code for [Google Sheets API](https://developers.google.com/workspace/sheets/api/reference/rest).

On how to add new API clients see section [Adding new clients](#adding-new-clients).

## Getting started
To get started with sbt, add the dependency to your project in `build.sbt`
```scala
libraryDependencies ++= Seq(
  "com.anymindgroup" %% "zio-gcp-auth" % "@VERSION@",
  // add clients based on needs
  "com.anymindgroup" %% "zio-gcp-storage" % "@VERSION@", // includes zio-gcp-storage-v1 and zio-gcp-iamcredentials-v1
  "com.anymindgroup" %% "zio-gcp-sheets" % "@VERSION@", // includes zio-gcp-sheets-v4
  // generated clients
  "com.anymindgroup" %% "zio-gcp-aiplatform-v1" % "@VERSION@",
  "com.anymindgroup" %% "zio-gcp-pubsub-v1" % "@VERSION@",
  "com.anymindgroup" %% "zio-gcp-storage-v1" % "@VERSION@",
  "com.anymindgroup" %% "zio-gcp-iamcredentials-v1" % "@VERSION@",
  "com.anymindgroup" %% "zio-gcp-sheets-v4" % "@VERSION@",
)
```

In a cross-platform project via [sbt-crossproject](https://github.com/portable-scala/sbt-crossproject) use `%%%` operator:
```scala
libraryDependencies += "com.anymindgroup" %%% "zio-gcp-auth" % "@VERSION@"
// etc.
```

### Client usage examples

#### Generate content via Vertex AI API:

```scala
//> using scala 3.7.4
//> using dep com.anymindgroup::zio-gcp-aiplatform-v1::@VERSION@

@ZIO_GCP_AIPLATFORM_EXAMPLE@
```

#### Upload file to storage bucket, create signed url, delete file
```scala
//> using scala 3.7.4
//> using dep com.anymindgroup::zio-gcp-storage::@VERSION@

@ZIO_GCP_STORAGE_EXAMPLE@
```

## Adding new clients
Look up and place the [discovery document](https://developers.google.com/discovery/v1/using) specs into the `codegen/src/main/resources` folder.  
E.g. like:
```shell
curl 'https://redis.googleapis.com/$discovery/rest?version=v1' > codegen/src/main/resources/redis_v1.json
```

In `build.sbt` find and extend the config for clients code to generate:
```scala
lazy val gcpClientsCrossProjects: Seq[CrossProject] = for {
  (apiName, apiVersion) <- Seq(
                             "aiplatform"     -> "v1",
                             "iamcredentials" -> "v1",
                             "pubsub"         -> "v1",
                             "storage"        -> "v1",
                             // new clients can be added here
                             // 1. Place the specs into codegen/src/main/resources folder e.g.:
                             // curl 'https://redis.googleapis.com/$discovery/rest?version=v1' > codegen/src/main/resources/redis_v1.json
                             // 2. add to configuration here according to the json file name "redis_v1.json" like:
                             // "redis"          -> "v1",
                           )
  // ...
}                         
```
_This step could be automated in the future._

Done. The package will be available as `"com.anymindgroup::zio-gcp-redis-v1"` on publishing.

## Authentication

The module `zio-gcp-auth` provides methods for authentication.  
It's primarily meant to run on a VM in Google Cloud and make use of [compute metadata](https://cloud.google.com/compute/docs/metadata/overview).

Currently supported credentials and tokens:

| Credentials | [Access token](https://cloud.google.com/docs/authentication/token-types#access) | [ID token](https://cloud.google.com/docs/authentication/token-types#id) |
| --- | --- | --- |
| [Service account](https://cloud.google.com/docs/authentication#service-accounts) (via [compute metadata](https://cloud.google.com/compute/docs/metadata/overview)) | ✅ | ✅ |
| [User credentials](https://cloud.google.com/docs/authentication/application-default-credentials#personal) | ✅ | ❌ |
| Service account (via private key) | ❌ | ❌ |

## Authentication / token provider usage examples

### Using default token provider (the token is cached and automatically refreshed)

```scala
@ZIO_GCP_AUTH_EXAMPLE@
```

### Simple access token retrieval without caching and auto refreshing
```scala
import zio.*, zio.Console.*, com.anymindgroup.gcp.auth.*, com.anymindgroup.http.*

object SimpleTokenRetrieval extends ZIOAppDefault:
  def run = httpBackendScoped()
    .flatMap(TokenProvider.defaultAccessTokenProvider(_).flatMap(_.token))
    .flatMap(r => printLine(s"got access token: ${r.token.token} at ${r.receivedAt}"))
```

### Use specific credentials

```scala
import zio.*, com.anymindgroup.gcp.auth.*, com.anymindgroup.http.*

object PassSpecificUserAccount extends ZIOAppDefault:
  def run =
    httpBackendScoped().flatMap: backend =>
      TokenProvider
        .accessTokenProvider(
          Credentials.UserAccount(
            refreshToken = "refresh_token",
            clientId = "123.apps.googleusercontent.com",
            clientSecret = Config.Secret("user_secret"),
          ),
          backend,
        )
```

### Change log level

All logging is using `ZIO.log`. This allows you to override the log level
as e.g. described in this [zio logging tutorial guide](https://zio.dev/guides/tutorials/enable-logging-in-a-zio-application#overriding-log-levels).  
Example of setting the token provider log level to debug:
```scala
import zio.*, com.anymindgroup.gcp.auth.*, com.anymindgroup.http.*

object SetLogLevelToDebug extends ZIOAppDefault:
  def run = ZIO.logLevel(LogLevel.Debug)(httpBackendScoped().flatMap(TokenProvider.defaultAccessTokenProvider(_)))
```

Run examples with sbt:
```shell
sbt examples/run
```
